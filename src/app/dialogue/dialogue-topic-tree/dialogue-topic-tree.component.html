<mat-card>
  <mat-card-title>
    <div class="dnd-tree-navigation">
      <button mat-icon-button aria-label="Top level" (click)="goToTop()" [disabled]="path.length === 0">
        <mat-icon class="dnd-rotate-clockwise">first_page</mat-icon>
      </button>
      <button mat-icon-button aria-label="Breadcrumbs" (click)="toggleBreadcrumbPanelVisibility()" [disabled]="!canShowBreadcrumbList">
        <mat-icon [color]="navigationPanel === 'breadcrumbs' ? 'primary' : ''">account_tree</mat-icon>
      </button>
      <button mat-icon-button aria-label="Find topic" (click)="toggleSearchBoxVisibility()">
        <mat-icon [color]="navigationPanel === 'searchBox' ? 'primary' : ''">search</mat-icon>
      </button>
      <button mat-icon-button aria-label="Add topic" (click)="addTopic()">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </mat-card-title>

  <mat-card-content>
    <mat-divider></mat-divider>

    <mat-form-field *ngIf="navigationPanel === 'searchBox'" class="dnd-full-width dnd-margin-top">
      <input matInput aria-label="Find topic" [(ngModel)]="searchPhrase" placeholder="Find topic"/>
    </mat-form-field>
    
    <mat-list class="dnd-breadcrumbs">
      <ng-container *ngIf="navigationPanel === 'breadcrumbs' && canShowBreadcrumbList">
        <mat-list-item (click)="goToTop()">
          <h4 mat-line>{{ npcName }} 's topics (top level)</h4>
          <p mat-line><dnd-topic-children-stats [source]="dialogue"></dnd-topic-children-stats></p>
        </mat-list-item>
        <mat-list-item *ngFor="let breadcrumb of breadcrumbTopics; let i = index" (click)="goToPath(i)">
          <mat-icon mat-list-icon>subdirectory_arrow_right</mat-icon>
          <h4 mat-line>{{ breadcrumb.label }}</h4>
          <p mat-line><dnd-topic-children-stats [source]="breadcrumb"></dnd-topic-children-stats></p>
        </mat-list-item>
      </ng-container>
  
      <mat-list-item *ngIf="path.length > 0" aria-label="Parent topic (click to open)" (click)="back()">
        <mat-icon mat-list-icon>arrow_upward</mat-icon>
        <h4 mat-line>{{ parentTopic.label }}</h4>
        <p mat-line><dnd-topic-children-stats [source]="parentTopic"></dnd-topic-children-stats></p>
      </mat-list-item>
      <mat-list-item *ngIf="path.length === 0">
        <h4 mat-line>{{ npcName }} 's topics</h4>
        <p mat-line><dnd-topic-children-stats [source]="dialogue"></dnd-topic-children-stats></p>
      </mat-list-item>
    </mat-list>

    <mat-divider></mat-divider>

    <mat-list *ngIf="topics.length > 0; else emptyTopicList" cdkDropList (cdkDropListDropped)="drop($event)">
      <mat-list-item *ngFor="let topic of topics; let i = index" class="dnd-topic-entry" (click)="open(i)" cdkDrag>
        <h3 mat-line [class.dnd-topic-selected]="i === selectedIndex">{{ topic.label }}</h3>
        <p mat-line><dnd-topic-children-stats [source]="topic"></dnd-topic-children-stats></p>
        <button mat-icon-button [attr.aria-label]="'Open ' + topic.label" (click)="onTopicClicked(i, $event)">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </mat-list-item>
    </mat-list>
    <ng-template #emptyTopicList>
      <mat-list>
        <mat-list-item (click)="addTopic()">
          The list is empty. Add a topic
        </mat-list-item>
      </mat-list>
    </ng-template>
    
  </mat-card-content>
</mat-card>
